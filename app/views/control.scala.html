@(username:String)

@import models._

@main("SpaceShip - Controller") {
  <h4 style="text-align:center;">@username</h4>
  <div class="col-xs-6" style="border: 2px solid black; background-color: #adadad; height: 120px;" id="joystick"></div>
  <div class="col-xs-6" style="border: 2px solid black; background-color: #afd9ee; height: 120px;" id="tir"></div>
  <div>&nbsp;</div>

  <script src="/assets/javascripts/nipplejs.min.js"></script>
  <script>
    const joystickParams = {
      zone: document.getElementById("joystick"),
      color: "blue"
    };
    var joystickData;
    function send() {
      if(joystickData) {
        var x = 0;
        var y = 0;
        if(joystickData.distance > 10) {
          if (joystickData.angle.degree < 45 || joystickData.angle.degree > 315) {
              x = 1;
          } else if (joystickData.angle.degree < 135) {
              y = 1;
          } else if (joystickData.angle.degree < 225) {
              x = -1;
          } else {
              y = -1;
          }
          console.log(x + ' ............... ' + y);
          console.log(joystickData.angle.radian + ' / ' + joystickData.angle.degree + ' : ' + joystickData.distance);
          fetch('/mvP/@username/' + x + '/' + y, {
            method: 'POST',
            header: {
              'Accept': 'application/json',
              'Content-Type': 'application/json'
            },
            body: '{}'
          });
        }
      }
    }
    var interval;
    const manager = nipplejs.create(joystickParams);
    manager.on('added', function(evt, nipple) {
      interval = setInterval(send, 1000/60);
      nipple.on('move', function(evt, data) {
        joystickData = data;
      });
    }).on('removed', function(evt) {
      if(interval) {
          window.clearInterval(interval);
      }
    });

    const tirParams = {
        zone: document.getElementById("tir"),
        color: "blue"
    };
    const manager2 = nipplejs.create(tirParams);
    manager2.on('added', function(evt, nipple) {
        console.log("tir");
    });
  </script>
}
